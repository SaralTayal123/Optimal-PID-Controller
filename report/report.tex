\documentclass[11pt]{article}

\input{sammath.sty}

\newcommand{\mycourse}{18-660: Optimization}
\newcommand{\secnum}{A}
\newcommand{\myhwnum}{3}

\renewcommand{\assignmenttype}{Homework}

\usepackage[colorlinks=true]{hyperref}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Document begins here %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
    \headings
    
    \section{Introduction}
    
    \section{Problem Formulation} \label{sec:prob}
    \subsection{Control System} \label{sec:prob:control}
    For our simulations, we are modelling the dynamics of the car with a simple non-linear bicycle model, with the following state ($x$) and control ($u$)
%    \begin{align*} 
%        x = \begin{bmatrix}
%            p_x \\ p_y \\ \theta \\ \delta \\ v \\ \omega
%        \end{bmatrix} &&
%        u = \begin{bmatrix}
%            a \\ \dot{\delta}
%        \end{bmatrix}
%    \end{align*}
    \begin{align*} 
        x = \transbmat{p_x & p_y & \theta & \delta & v} &&
        u = \transbmat{a & \dot{\delta}}
    \end{align*}
    where $p_x, p_y$ is the position, $\theta$ is the orientation, $\delta$ is the steering angle, and $v$ is the velocity. The controls for the bike are acceleration $a$, and steering angle rate $\dot{\delta}$. \\
    
    In order to make the system control-affine for easy optimization, we linearize our approximate dynamics model about $X_{ref}$ and $U_{ref}$ to get the following Jacobians for each step $k \in [1, N] $ in the trajectory:
    \begin{align*}
        A_k = \frac{\partial f}{\partial x}\bigg|_{x_{ref,k},u_{ref,k}} && 
        B_k = \frac{\partial f}{\partial u}\bigg|_{x_{ref,k},u_{ref,k}}
    \end{align*}
    where $f(x,u)$ is our approximate discrete dynamics model, $X_{ref}$ is the optimal trajectory computed offline with approximate dynamics model, and $U_{ref}$ is the optimal controls computed offline with approximate dynamics model. \\
%    - $X_{sim}$ (`Xsim`) -  Simulated trajectory with real dynamics model. 
    
    With this, the system becomes control-affine, where the states are given by
    \begin{align*}
        x_{k+1} = A_k x_k + B_k u_k
    \end{align*}
    and the proportional-derivative (PD) controller gives the control
    \begin{align*}
        u_k = - \left[\strut P * \left(x_{k} - x_{ref,k}\right) + D (x_k - x_{k-1}) \strut \right]
    \end{align*}
    where $P,D$ are the proportional and derivative control matrices to be found by our algorithm.
    
    \pagebreak
    
    \subsection{Optimizing for PD matrices} \label{sec:prob:pdoptim}
    In order to automatically tune the PD matrices, we optimize for best PD matrices that minimize the quadratic cost of the trajectory generated by the PID controller, as constrained by control-affine system dynamics. Mathematically, we attempt to solve the following problem:
    \begin{align*}
        \min_{P,D}\qquad & \transp{X - X_{ref}} Q \left(X - X_{ref}\right) \fracln
        \st \quad & x_1 = x_{ref, 1} \vecln
        &         x_{k+1} = A_k x_k + B_k u_k \vecln
        &         u_k = - \left[\strut P * \left(x_{k} - x_{ref,k}\right) + D (x_k - x_{k-1}) \strut \right]
    \end{align*}
    where $X, X_{ref}$ are the generated and reference trajectories respectively (a direct function of the states $x_k$), $Q \curlygeq 0 $ is a quadratic cost matrix, and $A_k, B_k$ are the Jacobians representing the linearized system dynamics as mentioned in Section \ref{sec:prob:control} above. \\
    
    We note that the cost function is quadratic and the constraints are affine, thus we have a quadratic programming problem.
    
\end{document}

